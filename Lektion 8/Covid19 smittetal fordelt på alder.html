<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Smittetal</title>
        <script type="text/javascript" src="d3.js"></script>

    </head>
    <body>
        <script type="text/javascript">

    // Indlæsning af filen csv-filen
        d3.csv("aarhus-covid19-smittetal-fordelt-på-alder.csv").then(function(data) {
                console.log(data);


    // Dataopsamling i et array med 20 værdier.
            let opsamling = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ];
            let aldersGruppe = [ "0-10" , "11-20", "21-30", "31-40", "41-50", 
                                 "51-60", "61-70", "71-80", "81-90", "91+"    ];
            let month = [];


    // Dataopsamling med et for-loop
        for (let svar of data) {
            let rowDate     = svar["date"];
            let rowAge      = svar["age"];
            let rowCount    = svar["count"];
            

    // Opsamling
    // December
              if (rowDate.includes("2020-12")) {
                  month[0] = rowDate.substring(0,7)
                
                  for (let i = 0; i < aldersGruppe.length; i++) {
                          if (rowAge.includes(aldersGruppe[i])) {
                            opsamling[i] = opsamling[i] + parseInt(rowCount)
                                        
                        }
                    }
                }
            }

    // Printer opsamlingen ud
            console.log(opsamling);

//---------------------------------------------------------------------------------------------------
// Visualization
//---------------------------------------------------------------------------------------------------

    // Width, height and padding
            let w = 500;
            let h = 500;
            let padding = 100;
            let barPadding = 20;

    // Create scales for x- and y-axis
            let xScale = d3.scaleLinear()
                        .domain([0, d3.max(opsamling)])
                        .range([0, w - padding]);                                   // Max range is the width of the svg minus room for "padding"
                        
            let yScale = d3.scaleLinear()
                        .domain([0, d3.max(opsamling)]) 
                        .range([0, h - padding]);

    //---------------------------------------------------------------------------------------------------
    // SVG
    
    // Create SVG element
            let svg = d3.select("body")
    						.append("svg")
	    					.attr("width", w)
		    				.attr("height", h);

    // Create bars
                svg.selectAll("rect")
	                        .data(opsamling)
        		            .enter()
		                    .append("rect")
		                    .attr("x", function(d, i) {
		 		                return i * (w / opsamling.length) + (padding / 10);
        		            })
		                    .attr("y", function(d) {
		 		                return (h - yScale(d)) - (padding / 2);

        		            })
                    		.attr("width", w / opsamling.length - barPadding)
            	        	.attr("height", function(d) {
                                 return yScale(d)
                            })
		                    .attr("fill", "rgb(200, 120, 100)");

    // Create labels for numbers
                svg.selectAll("text.labelNum")
                            .data(opsamling)
                            .enter()
                            .append("text")
                            .text(function(d) {
                                return d;
                            })
                            .attr("x", function(d, i) {
                                return i * (w / opsamling.length) + 25;
                            })
                            .attr("y", function(d) {
                                return h - 30;
                            })
                            .attr("font-family", "sans-serif")
                            .attr("font-size", "11px")
                            .attr("fill", "black")
                            .attr("text-anchor", "middle")
                            .attr("class", "labelNum")
                            .attr("font-weight", "bold");


    // Create labels for text
                svg.selectAll("text.labelQuestion")
                            .data(month)
                            .enter()
                            .append("text")
                            .text(function(d) {
                                return d;
                            })
                            .attr("x", function(d, i) {
                                return w / 2;
                            })
                            .attr("y", function(d) {
                                return h;
                            })
                            .attr("font-family", "sans-serif")
                            .attr("font-size", "16px")
                            .attr("fill", "black")
                            .attr("text-anchor", "middle")
                            .attr("class", "labelQuestion")
                            .attr("font-weight", "bold");
    });

        </script>
    </body>
</html>